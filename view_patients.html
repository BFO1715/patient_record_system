<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Patients</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header>
    <h1>View Patients</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="add_patient.html">Add Patient</a>
      <a href="statistics.html">Statistics</a>
    </nav>
  </header>
  <main>
    <h2>Patient Records</h2>
    <input type="text" id="searchBar" placeholder="Search by name or ID">
    <table id="patientsTable">
      <thead>
        <tr>
          <th>Patient ID</th>
          <th>Name</th>
          <th>Age</th>
          <th>BMI</th>
          <th>BMI Category</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Patient records will be injected here -->
      </tbody>
    </table>
  </main>
  <script src="js/app.js"></script>
  <script>
    const searchBar = document.getElementById('searchBar');
    const tableBody = document.querySelector('#patientsTable tbody');

    // Load patients from local storage
    const patients = JSON.parse(localStorage.getItem('patients')) || [];

    function displayPatients(filteredPatients = patients) {
      tableBody.innerHTML = '';
      filteredPatients.forEach(patient => {
        const row = document.createElement('tr');

        const age = calculateAge(patient.dob);
        const bmi = calculateBMI(patient.weight, patient.height);
        const bmiCategory = getBMICategory(bmi);

        row.innerHTML = `
          <td>${patient.id}</td>
          <td>${patient.firstName} ${patient.lastName}</td>
          <td>${age}</td>
          <td>${bmi.toFixed(2)}</td>
          <td>${bmiCategory}</td>
          <td>
            <button onclick="editPatient('${patient.id}')">Edit</button>
            <button onclick="deletePatient('${patient.id}')">Delete</button>
          </td>
        `;

        tableBody.appendChild(row);
      });
    }

    searchBar.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      const filteredPatients = patients.filter(patient =>
        patient.firstName.toLowerCase().includes(query) ||
        patient.lastName.toLowerCase().includes(query) ||
        patient.id.toLowerCase().includes(query)
      );
      displayPatients(filteredPatients);
    });

    function calculateAge(dob) {
      const birthDate = new Date(dob);
      const today = new Date();
      return today.getFullYear() - birthDate.getFullYear() - (today < new Date(today.getFullYear(), birthDate.getMonth(), birthDate.getDate()) ? 1 : 0);
    }

    function calculateBMI(weight, height) {
      const heightInMeters = height / 100;
      return weight / (heightInMeters * heightInMeters);
    }

    function getBMICategory(bmi) {
      if (bmi < 18.5) return 'Underweight';
      if (bmi < 25) return 'Normal';
      if (bmi < 30) return 'Overweight';
      return 'Obese';
    }

    function editPatient(id) {
      alert(`Editing patient ${id} is not implemented yet.`);
    }

    function deletePatient(id) {
      if (confirm('Are you sure you want to delete this patient?')) {
        const updatedPatients = patients.filter(patient => patient.id !== id);
        localStorage.setItem('patients', JSON.stringify(updatedPatients));
        displayPatients();
      }
    }

    displayPatients();
  </script>
</body>
</html>